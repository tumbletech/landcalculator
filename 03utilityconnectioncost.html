<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Land Purchase Cost</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light">

    <!-- Header -->
    <nav class="navbar lime-header bg-dark px-3">
        <div class="container-fluid text-white">
        <a href="00b.dashboard.html" class="btn btn-sm btn-outline-light me-2">‚Üê Back</a>
        <span class="navbar-brand mb-0 h6 text-white">Utility Connection Cost</span>
        </div>
    </nav>

    <!--- Picked Property Details --->
    <div class="mb-3 bg-light border rounded small p-2">
        <div><strong>Address:</strong> <span id="summaryAddress">Loading...</span></div>
        <div><strong>Parcel ID:</strong> <span id="summaryParcelID">Loading...</span></div>
        <div><strong>Coordinates:</strong> <span id="summaryCoords">Loading...</span></div>
    </div>

    <div class="container my-5">

      <!-- Water -->
      <div class="mb-4">
        <h6 class="fw-bold">Water Source</h6>
        <div class="row g-2 align-items-end">
          <div class="col-md-4">
            <label class="form-label">Type</label>
            <select id="waterSource" class="form-select">
              <option selected disabled>Choose Water Source</option>
              <option value="public">Public Utility Water</option>
              <option value="well">Private Water Well</option>
              <option value="co-op">Water Co-op</option>
              <option value="haul">Water Hauling (Tank Storage)</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label">Unit Cost ($)</label>
            <input type="number" id="waterUnitCost" class="form-control" min="0" step="0.01">
          </div>
          <div class="col-md-3">
            <label class="form-label">Subtotal ($)</label>
            <input type="text" id="waterSubtotal" class="form-control" readonly>
          </div>
        </div>
      </div>

      <!-- Sewer -->
      <div class="mb-4">
        <h6 class="fw-bold">Sewer System</h6>
        <div class="row g-2 align-items-end">
          <div class="col-md-4">
            <label class="form-label">Type</label>
            <select id="sewerSystem" class="form-select">
              <option selected disabled>Choose Wastewater System</option>
              <option value="septic">Septic Tank (Conventional)</option>
              <option value="aerobic">Aerobic OSSF</option>
              <option value="mound">Mound System</option>
              <option value="public">Public Sewer</option>
              <option value="composting">Composting Toilet</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label">Unit Cost ($)</label>
            <input type="number" id="sewerUnitCost" class="form-control" min="0" step="0.01">
          </div>
          <div class="col-md-3">
            <label class="form-label">Subtotal ($)</label>
            <input type="text" id="sewerSubtotal" class="form-control" readonly>
          </div>
        </div>
      </div>

      <!-- Power -->
      <div class="mb-4">
        <h6 class="fw-bold">Power Supply</h6>
        <div class="row g-2 align-items-end">
          <div class="col-md-4">
            <label class="form-label">Type</label>
            <select id="powerSource" class="form-select">
              <option selected disabled>Choose Power Source</option>
              <option value="public">Grid Connection</option>
              <option value="solar">Off-Grid Solar</option>
              <option value="generator">Diesel Generator</option>
              <option value="hybrid">Hybrid</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label">Unit Cost ($)</label>
            <input type="number" id="powerUnitCost" class="form-control" min="0" step="0.01">
          </div>
          <div class="col-md-3">
            <label class="form-label">Subtotal ($)</label>
            <input type="text" id="powerSubtotal" class="form-control" readonly>
          </div>
        </div>
      </div>

    <!-- Gas -->
    <div class="mb-4">
      <h6 class="fw-bold">Gas Source</h6>
      <div class="row g-2 align-items-end">
        <div class="col-md-4">
          <label class="form-label">Type</label>
          <select id="gasType" class="form-select">
            <option selected disabled>Choose Gas Supply</option>
            <option value="propane">Propane Tank</option>
            <option value="natural">Natural Gas Line</option>
            <option value="none">None</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Unit Cost ($)</label>
          <input type="number" id="gasUnitCost" class="form-control" min="0" step="0.01">
        </div>
        <div class="col-md-3">
          <label class="form-label">Subtotal ($)</label>
          <input type="text" id="gasSubtotal" class="form-control" readonly>
        </div>
      </div>
    </div>

    <!-- Phone -->
    <div class="mb-4">
      <h6 class="fw-bold">Phone Service</h6>
      <div class="row g-2 align-items-end">
        <div class="col-md-4">
          <label class="form-label">Type</label>
          <select id="phoneType" class="form-select">
            <option selected disabled>Choose Phone Type</option>
            <option value="landline">Landline</option>
            <option value="cell">Cellular</option>
            <option value="none">None</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Unit Cost ($)</label>
          <input type="number" id="phoneUnitCost" class="form-control" min="0" step="0.01">
        </div>
        <div class="col-md-3">
          <label class="form-label">Subtotal ($)</label>
          <input type="text" id="phoneSubtotal" class="form-control" readonly>
        </div>
      </div>
    </div>

    <!-- Internet -->
    <div class="mb-4">
      <h6 class="fw-bold">Internet Service</h6>
      <div class="row g-2 align-items-end">
        <div class="col-md-4">
          <label class="form-label">Type</label>
          <select id="internetType" class="form-select">
            <option selected disabled>Choose Internet Source</option>
            <option value="fiber">Fiber Optic</option>
            <option value="dsl">DSL / Wired</option>
            <option value="satellite">Satellite</option>
            <option value="cellular">Mobile Data</option>
            <option value="none">None</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Unit Cost ($)</label>
          <input type="number" id="internetUnitCost" class="form-control" min="0" step="0.01">
        </div>
        <div class="col-md-3">
          <label class="form-label">Subtotal ($)</label>
          <input type="text" id="internetSubtotal" class="form-control" readonly>
        </div>
      </div>
    </div>

    <!-- Total Utility Cost -->
    <div class="border-top pt-4">
      <h5 class="fw-bold">Total Utility Cost: <span id="totalUtilityCost">$0.00</span></h5>
    </div>
  
    <div>
      <button class="btn btn-dark" onclick="saveAndContinue()">Continue</button>
    </div>
  </div>

      <!-- Total -->
      <div class="my-4">
          <button type="submit" class="btn btn-dark w-100">Calculate Total</button>
      </div>

      </form>

      <div id="totalResult" class="alert alert-success d-none"></div>
    </div>

      <div class="mt-4">
      <div class="d-grid gap-3">
          <a href="contact-lht.html" class="btn btn-outline-dark">
          üí¨ Talk to an LHT Expert
          </a>
          <a href="00b.dashboard.html" class="btn btn-dark">
          ‚ûï Proceed with Estimating Other Items
          </a>
      </div>
      </div>

    <script>
      function formatUSD(num) {
        return '$' + Number(num).toLocaleString();
      }

      function parseUSD(str) {
        return parseFloat(str.replace(/[$,]/g, '')) || 0;
      }

      function calculateCosts() {
        const listingPrice = parseFloat(localStorage.getItem('selectedListingPrice')) || 0;

        const earnest = listingPrice * 0.015;
        const closing = listingPrice * 0.03;

        const fixed = {
          titleInsurance: 900,
          survey: 600,
          proratedTax: 1200,
          hoaFee: 350,
          optionFee: 100,
          loanFee: 750
        };

        const total =
          listingPrice +
          earnest +
          fixed.titleInsurance +
          fixed.survey +
          closing +
          fixed.proratedTax +
          fixed.hoaFee +
          fixed.optionFee +
          fixed.loanFee;

        // Display values
        document.getElementById("listingPrice").value = formatUSD(listingPrice);
        document.getElementById("earnestMoney").value = formatUSD(earnest);
        document.getElementById("closingCosts").value = formatUSD(closing);
        document.getElementById("totalCost").value = formatUSD(total);

        // Store for next module
        localStorage.setItem("totalLandAcquisitionCost", total.toFixed(2));
      }

      function saveAndContinue() {
        alert("Cost saved. Proceeding...");
        window.location.href = "03utilityconnectioncost.html"; // adjust path if needed
      }

      window.onload = calculateCosts;
    </script>

    <script>
      // Load from localStorage and display selected parcel info
      const address = localStorage.getItem("parcelAddress") || "N/A";
      const parcelID = localStorage.getItem("parcelID") || "N/A";
      const lat = localStorage.getItem("latitude") || "N/A";
      const lng = localStorage.getItem("longitude") || "N/A";

      document.getElementById("summaryAddress").textContent = address;
      document.getElementById("summaryParcelID").textContent = parcelID;
      document.getElementById("summaryCoords").textContent = `${lat}, ${lng}`;
    </script>

    <script>
      function computeUtilityCosts() {
        const ids = ["water", "sewer", "power", "gas", "phone", "internet"];
        let total = 0;

        ids.forEach((id) => {
          const unit = parseFloat(document.getElementById(`${id}UnitCost`).value) || 0;
          const subtotalEl = document.getElementById(`${id}Subtotal`);
          subtotalEl.value = unit.toFixed(2);
          total += unit;
        });

        document.getElementById("totalUtilityCost").textContent = `$${total.toFixed(2)}`;
      }

      // Attach event listeners
      ["water", "sewer", "power", "gas", "phone", "internet"].forEach((id) => {
        document.getElementById(`${id}UnitCost`).addEventListener("input", computeUtilityCosts);
        document.getElementById(`${id}Type`)?.addEventListener("change", computeUtilityCosts);
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
